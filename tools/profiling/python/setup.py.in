#!/usr/bin/env python
# build script for py_dbpreader
# run python setup.py build_ext --inplace to build

from distutils.core import setup
from distutils.extension import Extension
from Cython.Distutils import build_ext, extension
import os.path
import sys
import socket

libdaguebase = '@PROJECT_BINARY_DIR@/dague/libdague-base.a'

libs = ['irc', 'imf']
lib_dirs = ['/mnt/scratch/sw/intel/composer_xe_2013/lib/intel64/']
run_dirs = ['/mnt/scratch/sw/intel/composer_xe_2013/lib/intel64/']

ext_modules = [Extension('py_dbpreader', ['@CMAKE_CURRENT_SOURCE_DIR@/py_dbpreader.pyx',
                                          '@CMAKE_CURRENT_SOURCE_DIR@/../dbpreader.c'],
                                          include_dirs=['@PROJECT_SOURCE_DIR@/include',
                                                        '@PROJECT_SOURCE_DIR@',
                                                        '@PROJECT_BINARY_DIR@/include',
                                                        '@PROJECT_BINARY_DIR@',
                                                        '@CMAKE_CURRENT_SOURCE_DIR@/../'],
                         extra_objects=[libdaguebase],
                                          depends=['py_dbpreader.pxd',
                                                   '@CMAKE_CURRENT_BINARY_DIR@/../dbpreader.h',
                                                   '@PROJECT_SOURCE_DIR@/include/dbp.h',
                                                   '@PROJECT_SOURCE_DIR@/include/os-spec-timing.h'],
                         library_dirs=lib_dirs,
                         runtime_library_dirs=run_dirs,
                         libraries=libs,
#                                          extra_compile_args=['@CMAKE_C_FLAGS@']
                                          )]

setup(
  name = 'dbpreader python interface',
  version='@PACKAGE_VERSION@',
  description='PaRSEC profiling parser',
  url='http://icl.cs.utk.edu/parsec/',
  package_dir={ '': '@CMAKE_CURRENT_BINARY_DIR@' },
  cmdclass = {'build_ext': build_ext},
  ext_modules = ext_modules
)
