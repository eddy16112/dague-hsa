include(RulesJDF)

jdf_rules(rtt_generated "${CMAKE_CURRENT_SOURCE_DIR}/rtt.jdf")
string( REGEX REPLACE "rtt.[hc]" "" include_dir "${rtt_generated}" )
include_directories(${include_dir})

if( MPI_FOUND )
  add_executable(mpi_rtt ${rtt_generated} rtt_wrapper.c rtt_data.c main.c)
  set_target_properties(mpi_rtt PROPERTIES LINKER_LANGUAGE C)
  set_target_properties(mpi_rtt PROPERTIES LINK_FLAGS "${MPI_LINK_FLAGS} ${LOCAL_C_LINK_FLAGS} ${HWLOC_LIB}")
  target_link_libraries(mpi_rtt dague-mpi ${MPI_LIBRARIES})
else(MPI_FOUND)
  add_executable(rtt ${rtt_generated} rtt_wrapper.c rtt_data.c main.c)
  set_target_properties(rtt PROPERTIES LINKER_LANGUAGE C)
  set_target_properties(rtt PROPERTIES LINK_FLAGS "${LOCAL_C_LINK_FLAGS} ${HWLOC_LIB}")
  target_link_libraries(rtt dague)
endif( MPI_FOUND )
